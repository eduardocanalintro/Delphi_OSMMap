<!DOCTYPE html>
<html lang="en">
<head>
<title>OSM Map control: OSM.NetworkRequest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="PasDoc 0.16.0">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="StyleSheet" type="text/css" href="pasdoc.css">
</head>
<body>
<div class="container"><div class="navigation">
<h2><a href="index.html">OSM Map control</a></h2><ul><li><a href="AllUnits.html">Units</a></li><li><a href="ClassHierarchy.html">Class Hierarchy</a></li><li><a href="AllClasses.html">Classes, Interfaces, Objects and Records</a></li><li><a href="AllTypes.html">Types</a></li><li><a href="AllVariables.html">Variables</a></li><li><a href="AllConstants.html">Constants</a></li><li><a href="AllFunctions.html">Functions and Procedures</a></li><li><a href="AllIdentifiers.html">Identifiers</a></li></ul></div><div class="content">
<h1 class="unit">Unit OSM.NetworkRequest</h1>
<div class="sections">
<div class="one_section"><a class="section" href="#PasDoc-Description">Description</a></div><div class="one_section">Uses</div><div class="one_section"><a class="section" href="#PasDoc-Classes">Classes, Interfaces, Objects and Records</a></div><div class="one_section"><a class="section" href="#PasDoc-FuncsProcs">Functions and Procedures</a></div><div class="one_section"><a class="section" href="#PasDoc-Types">Types</a></div><div class="one_section"><a class="section" href="#PasDoc-Constants">Constants</a></div><div class="one_section">Variables</div></div>
<span id="PasDoc-Description"></span><h2 class="description">Description</h2>
<p>
Generic (no real network implementation) classes and declarations for requesting OSM tile images from network. Real network function from any framework must be supplied to actually execute request.

<p>DEFINES: </p>

<ul class="paragraph_spacing">
  <li><p>OSM_Trace - print request trace messages to Windows debug log</p></li>
</ul>

<p> (c) Fr0sT-Brutal <a href="https://github.com/Fr0sT-Brutal/Delphi_OSMMap">https://github.com/Fr0sT-Brutal/Delphi_OSMMap</a>

<p></p>
<span id="PasDoc-Uses"></span><h2 class="overview">Overview</h2>
<span id="PasDoc-Classes"></span><h3 class="cio">Classes, Interfaces, Objects and Records</h3>
<table class="classestable wide_list">
<tr class="listheader">
<th class="itemname">Name</th>
<th class="itemdesc">Description</th>
</tr>
<tr class="list">
<td class="itemname">Class&nbsp;<a class="bold" href="OSM.NetworkRequest.THttpRequestProps.html"><code>THttpRequestProps</code></a></td>
<td class="itemdesc">Generic properties of request.</td>
</tr>
<tr class="list2">
<td class="itemname">Class&nbsp;<a class="bold" href="OSM.NetworkRequest.TNetworkRequestQueue.html"><code>TNetworkRequestQueue</code></a></td>
<td class="itemdesc">Queuer of network requests.</td>
</tr>
</table>
<span id="PasDoc-FuncsProcs"></span><h3 class="summary">Functions and Procedures</h3>
<table class="summary wide_list">
<tr class="list">
<td class="itemcode"><code>procedure <strong><a href="OSM.NetworkRequest.html#CheckEngineCap-THttpRequestCapability-THttpRequestCapabilities-">CheckEngineCap</a></strong>(NeededCap: <a href="OSM.NetworkRequest.html#THttpRequestCapability">THttpRequestCapability</a>; Caps: <a href="OSM.NetworkRequest.html#THttpRequestCapabilities">THttpRequestCapabilities</a>);</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>procedure <strong><a href="OSM.NetworkRequest.html#CheckEngineCaps-THttpRequestProps-THttpRequestCapabilities-">CheckEngineCaps</a></strong>(RequestProps: <a href="OSM.NetworkRequest.THttpRequestProps.html">THttpRequestProps</a>; EngineCapabilities: <a href="OSM.NetworkRequest.html#THttpRequestCapabilities">THttpRequestCapabilities</a>);</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <strong><a href="OSM.NetworkRequest.html#IsHTTPError-Word-">IsHTTPError</a></strong>(ResponseCode: Word): Boolean;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>procedure <strong><a href="OSM.NetworkRequest.html#CheckHTTPError-Word-string-">CheckHTTPError</a></strong>(ResponseCode: Word; const ResponseText: string);</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code>function <strong><a href="OSM.NetworkRequest.html#GetSystemProxy-string-TArray-TArray-const-">GetSystemProxy</a></strong>(const URL: string; out Bypass: TArray&lt;string&gt;): string; overload;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code>function <strong><a href="OSM.NetworkRequest.html#GetSystemProxy-string-">GetSystemProxy</a></strong>(const URL: string): string; overload;</code></td>
</tr>
</table>
<span id="PasDoc-Types"></span><h3 class="summary">Types</h3>
<table class="summary wide_list">
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#THttpRequestCapability">THttpRequestCapability</a></strong> = (...);</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#THttpRequestCapabilities">THttpRequestCapabilities</a></strong> = set of <a href="OSM.NetworkRequest.html#THttpRequestCapability">THttpRequestCapability</a>;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#TNetworkClient">TNetworkClient</a></strong> = TObject;</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#TBlockingNetworkRequestProc-THttpRequestProps-TStream-TNetworkClient-">TBlockingNetworkRequestProc</a></strong> = procedure (RequestProps: <a href="OSM.NetworkRequest.THttpRequestProps.html">THttpRequestProps</a>; ResponseStm: TStream; var Client: <a href="OSM.NetworkRequest.html#TNetworkClient">TNetworkClient</a>);</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#TGotTileCallbackBgThr-TTile-TMemoryStream-string-">TGotTileCallbackBgThr</a></strong> = procedure (const Tile: <a href="OSM.SlippyMapUtils.TTile.html">TTile</a>; Ms: TMemoryStream; const Error: string) of object;</code></td>
</tr>
</table>
<span id="PasDoc-Constants"></span><h3 class="summary">Constants</h3>
<table class="summary wide_list">
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#HTTPProto">HTTPProto</a></strong> = 'http';</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#HTTPTLSProto">HTTPTLSProto</a></strong> = 'https';</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#ProtoSep">ProtoSep</a></strong> = '://';</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#HTTPProxyProto">HTTPProxyProto</a></strong> = <a href="OSM.NetworkRequest.html#HTTPProto">HTTPProto</a> + <a href="OSM.NetworkRequest.html#ProtoSep">ProtoSep</a>;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#SystemProxy">SystemProxy</a></strong> = <a href="OSM.NetworkRequest.html#HTTPProxyProto">HTTPProxyProto</a> + 'SYSTEM';</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#ReqTimeout">ReqTimeout</a></strong> = 5*MSecsPerSec;</code></td>
</tr>
<tr class="list">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#SampleUserAgent">SampleUserAgent</a></strong> = 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0';</code></td>
</tr>
<tr class="list2">
<td class="itemcode"><code><strong><a href="OSM.NetworkRequest.html#SampleHeaders">SampleHeaders</a></strong>: array[0..2] of string =
  (
    'User-Agent: ' + <a href="OSM.NetworkRequest.html#SampleUserAgent">SampleUserAgent</a>,
    'Accept-Language: en-US;q=0.7,en;q=0.3',
    'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  );</code></td>
</tr>
</table>
<h2 class="description">Description</h2>
<h3 class="detail">Functions and Procedures</h3>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="CheckEngineCap-THttpRequestCapability-THttpRequestCapabilities-"></span><code>procedure <strong>CheckEngineCap</strong>(NeededCap: <a href="OSM.NetworkRequest.html#THttpRequestCapability">THttpRequestCapability</a>; Caps: <a href="OSM.NetworkRequest.html#THttpRequestCapabilities">THttpRequestCapabilities</a>);</code></td>
</tr>
<tr><td colspan="1">
<p>
Check if capability is in set of capabilities and raise exception if not</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="CheckEngineCaps-THttpRequestProps-THttpRequestCapabilities-"></span><code>procedure <strong>CheckEngineCaps</strong>(RequestProps: <a href="OSM.NetworkRequest.THttpRequestProps.html">THttpRequestProps</a>; EngineCapabilities: <a href="OSM.NetworkRequest.html#THttpRequestCapabilities">THttpRequestCapabilities</a>);</code></td>
</tr>
<tr><td colspan="1">
<p>
Check if a network engine is capable of handling all the request properties. Checks for: <a class="normal" href="OSM.NetworkRequest.html#htcProxy">htcProxy</a>, <a class="normal" href="OSM.NetworkRequest.html#htcSystemProxy">htcSystemProxy</a>, <a class="normal" href="OSM.NetworkRequest.html#htcProxyAuth">htcProxyAuth</a>, <a class="normal" href="OSM.NetworkRequest.html#htcAuth">htcAuth</a>, <a class="normal" href="OSM.NetworkRequest.html#htcAuthURL">htcAuthURL</a>, <a class="normal" href="OSM.NetworkRequest.html#htcTLS">htcTLS</a>, <a class="normal" href="OSM.NetworkRequest.html#htcHeaders">htcHeaders</a>.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="IsHTTPError-Word-"></span><code>function <strong>IsHTTPError</strong>(ResponseCode: Word): Boolean;</code></td>
</tr>
<tr><td colspan="1">
<p>
Return true if response code means HTTP error</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="CheckHTTPError-Word-string-"></span><code>procedure <strong>CheckHTTPError</strong>(ResponseCode: Word; const ResponseText: string);</code></td>
</tr>
<tr><td colspan="1">
<p>
Check if response code means HTTP error, raise exception then</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="GetSystemProxy-string-TArray-TArray-const-"></span><code>function <strong>GetSystemProxy</strong>(const URL: string; out Bypass: TArray&lt;string&gt;): string; overload;</code></td>
</tr>
<tr><td colspan="1">
<p>
Retrieve system proxy for given URL (http, https). Only returns HTTP proxies (not Socks). On Windows uses InternetQueryOption, on Linux takes env variables <code>HTTP(S)_PROXY</code>. Returns addresses for direct connection in Bypass array.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="GetSystemProxy-string-"></span><code>function <strong>GetSystemProxy</strong>(const URL: string): string; overload;</code></td>
</tr>
<tr><td colspan="1">
<p>
Overload when addresses to bypass proxy are not of interest</p>
</td></tr>
</table>
<h3 class="detail">Types</h3>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="THttpRequestCapability"></span><code><strong>THttpRequestCapability</strong> = (...);</code></td>
</tr>
<tr><td colspan="1">
<p>
Capabilities that a network engine has</p>
<h6 class="description_section">Values</h6>
<ul>
<li>
<span id="htcProxy">htcProxy</span>: Support HTTP proxy</li>
<li>
<span id="htcDirect">htcDirect</span>: Support direct connect bypassing OS-wide proxy. In fact, only WinInet-based engines (WinInet, RTL in Windows) use OS-wide proxy by default. In other engines and in Linux the proxy must be set explicitly so this cap is actual for all engines.</li>
<li>
<span id="htcSystemProxy">htcSystemProxy</span>: Can use OS-wide proxy</li>
<li>
<span id="htcProxyAuth">htcProxyAuth</span>: Support auth to proxy defined in URL</li>
<li>
<span id="htcAuth">htcAuth</span>: Support auth to host</li>
<li>
<span id="htcAuthURL">htcAuthURL</span>: Support auth to host defined in URL</li>
<li>
<span id="htcHeaders">htcHeaders</span>: Support sending custom headers</li>
<li>
<span id="htcTimeout">htcTimeout</span>: Support request timeout</li>
<li>
<span id="htcTLS">htcTLS</span>: Support HTTPS</li>
</ul>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="THttpRequestCapabilities"></span><code><strong>THttpRequestCapabilities</strong> = set of <a href="OSM.NetworkRequest.html#THttpRequestCapability">THttpRequestCapability</a>;</code></td>
</tr>
<tr><td colspan="1">
<p class="nodescription">This item has no description.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="TNetworkClient"></span><code><strong>TNetworkClient</strong> = TObject;</code></td>
</tr>
<tr><td colspan="1">
<p>
Base class for network client object. Used when request queue is performed through the same connection. Destructor of the object is called when the queue is empty and it must free all allocated resources.</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="TBlockingNetworkRequestProc-THttpRequestProps-TStream-TNetworkClient-"></span><code><strong>TBlockingNetworkRequestProc</strong> = procedure (RequestProps: <a href="OSM.NetworkRequest.THttpRequestProps.html">THttpRequestProps</a>; ResponseStm: TStream; var Client: <a href="OSM.NetworkRequest.html#TNetworkClient">TNetworkClient</a>);</code></td>
</tr>
<tr><td colspan="1">
<p>
Generic type of blocking network request procedure. Procedure must:

<p></p>

<ul class="paragraph_spacing">
  <li><p>Ensure URL requisites have priority over field requisites</p></li>
  <li><p>Set timeouts for request to <a class="normal" href="OSM.NetworkRequest.html#ReqTimeout">ReqTimeout</a></p></li>
  <li><p>Raise exception on validation/connection/request error</p></li>
  <li><p>Free all resources it has allocated</p></li>
</ul>

<p>    </p>
<h6 class="description_section">Parameters</h6>
<dl class="parameters">
<dt>RequestProps</dt>
<dd>- all details regarding a request</dd>
<dt>ResponseStm</dt>
<dd>- stream that accepts response data</dd>
<dt>Client</dt>
<dd>- [IN/OUT] If the engine supports multiple requests inside the same client, this parameter is the current client object. Request properties are supposed to remain unchanged throughout the whole queue (only <a class="normal" href="OSM.NetworkRequest.THttpRequestProps.html#URL">URL</a> changes) so it's enough to assign them at client creation only <br> IN: client object to use for requests. <br> OUT: newly created client object if <code>Client</code> was <code>Nil</code> at input.</dd>
</dl>
<h6 class="description_section">Exceptions raised</h6>
<dl class="exceptions_raised">
<dt><code>exception</code></dt>
<dd>on error</dd>
</dl>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="TGotTileCallbackBgThr-TTile-TMemoryStream-string-"></span><code><strong>TGotTileCallbackBgThr</strong> = procedure (const Tile: <a href="OSM.SlippyMapUtils.TTile.html">TTile</a>; Ms: TMemoryStream; const Error: string) of object;</code></td>
</tr>
<tr><td colspan="1">
<p>
Generic type of method to call when request is completed <br> ! <strong>Called from the context of a background thread</strong> !   </p>
<h6 class="description_section">Parameters</h6>
<dl class="parameters">
<dt>Tile</dt>
<dd>- tile that has been received</dd>
<dt>Ms</dt>
<dd>- stream with tile image data. In case of error, it could be <code>Nil</code> even if <code>Error</code> is empty</dd>
<dt>Error</dt>
<dd>- error description if any</dd>
</dl>
</td></tr>
</table>
<h3 class="detail">Constants</h3>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="HTTPProto"></span><code><strong>HTTPProto</strong> = 'http';</code></td>
</tr>
<tr><td colspan="1">
<p class="nodescription">This item has no description.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="HTTPTLSProto"></span><code><strong>HTTPTLSProto</strong> = 'https';</code></td>
</tr>
<tr><td colspan="1">
<p class="nodescription">This item has no description.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="ProtoSep"></span><code><strong>ProtoSep</strong> = '://';</code></td>
</tr>
<tr><td colspan="1">
<p class="nodescription">This item has no description.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="HTTPProxyProto"></span><code><strong>HTTPProxyProto</strong> = <a href="OSM.NetworkRequest.html#HTTPProto">HTTPProto</a> + <a href="OSM.NetworkRequest.html#ProtoSep">ProtoSep</a>;</code></td>
</tr>
<tr><td colspan="1">
<p>
Prefix to add to proxy URLs if it only contains <code>host:port</code> - some URL parsers handle such inputs as <code>proto:path</code></p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="SystemProxy"></span><code><strong>SystemProxy</strong> = <a href="OSM.NetworkRequest.html#HTTPProxyProto">HTTPProxyProto</a> + 'SYSTEM';</code></td>
</tr>
<tr><td colspan="1">
<p>
Internal constant to designate OS-wide proxy</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="ReqTimeout"></span><code><strong>ReqTimeout</strong> = 5*MSecsPerSec;</code></td>
</tr>
<tr><td colspan="1">
<p>
Timeout for connect and request</p>
</td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="SampleUserAgent"></span><code><strong>SampleUserAgent</strong> = 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:51.0) Gecko/20100101 Firefox/51.0';</code></td>
</tr>
<tr><td colspan="1">
<p class="nodescription">This item has no description.</p></td></tr>
</table>
<table class="detail wide_list">
<tr class="list">
<td class="itemcode"><span id="SampleHeaders"></span><code><strong>SampleHeaders</strong>: array[0..2] of string =
  (
    'User-Agent: ' + <a href="OSM.NetworkRequest.html#SampleUserAgent">SampleUserAgent</a>,
    'Accept-Language: en-US;q=0.7,en;q=0.3',
    'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
  );</code></td>
</tr>
<tr><td colspan="1">
<p>
Headers that you could add to <a class="normal" href="OSM.NetworkRequest.THttpRequestProps.html#HeaderLines">TNetworkRequestQueue.RequestProps.HeaderLines</a>. F.ex., openstreetmap.org dislikes requests without user-agent.</p>
</td></tr>
</table>
<h2 class="authors">Author</h2>
<ul class="authors">
<li>Fr0sT-Brutal (https://github.com/Fr0sT-Brutal)</li>
</ul>
<hr><span class="appinfo"><em>Generated by <a href="https://pasdoc.github.io/">PasDoc 0.16.0</a>. </em>
</span>
</div></div></body></html>
